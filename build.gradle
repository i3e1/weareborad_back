plugins {
    id 'org.springframework.boot' version '2.6.5'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    //querydsl ì¶”ê°€
    id "com.ewerk.gradle.plugins.querydsl" version "1.0.10"
    id 'java'
}

group = 'com.board'
version = '0.0.1'
sourceCompatibility = '17'

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
    querydsl.extendsFrom compileClasspath
}

repositories {
    mavenCentral()
}

ext {
    set('snippetsDir', file("build/generated-snippets")) // ë¬¸ì„œ ì €ì¥ìœ„ì¹˜
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-websocket'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.jetbrains:annotations:20.1.0'
    implementation group: 'org.springframework.boot', name: 'spring-boot-starter-logging', version: '2.6.2'
    implementation 'org.springframework.boot:spring-boot-starter-validation' // íŒŒë¼ë¯¸í„° ê°’ í™•ì¸(ì¸ì¦, Bean Validation)ì„ ìœ„í•´

    // database
//    runtimeOnly 'com.h2database:h2'
    // https://mvnrepository.com/artifact/mysql/mysql-connector-java // ìµœì‹ ë²„ì „ ë°›ì•„ì§..
    implementation group: 'mysql', name: 'mysql-connector-java', version: '5.1.41'
//    runtimeOnly 'mysql:mysql-connector-java'

    //lombok
    compileOnly 'org.projectlombok:lombok'

    //querydsl ì¶”ê°€
    implementation 'com.querydsl:querydsl-jpa'

    // ì¿¼ë¦¬dsl ì—ì„œ ì¿¼ë¦¬ê°€ ?ë¡œ ë‚˜ì˜¤ëŠ”ë° ?ë¥¼ ë°”ë¡œ ë³¼ ìˆ˜ ìˆê²Œ ë¨. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í›„.. ì¶”ê°€í• ì§€ .. ì •í•˜ê³ 
    // ë¹„ì§€ë‹ˆìŠ¤ì ìœ¼ë¡œ ë¡œê·¸ë¥¼ ë‚¨ê²¨ì•¼í•˜ë©´ ì¶”ê°€í•˜ë©´ ì¢‹ë‹¤.
    implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.8'

    // jwt
    implementation group: 'io.jsonwebtoken', name: 'jjwt', version: '0.9.1'


    // javaì—ì„œ json í˜•íƒœë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬. ë°±ì—”ë“œ í•˜ë‹¤ë³´ë©´ ì“¸ ì¼ì´ ì–¸ì  ê°„ ìƒê¹ë‹ˆë‹¤.
    implementation group: 'com.google.code.gson', name: 'gson', version: '2.8.6'

    annotationProcessor 'org.projectlombok:lombok' // ì´ê²Œ ìˆì–´ì•¼ ì •ìƒì‘ë™.
    annotationProcessor group: 'com.querydsl', name: 'querydsl-apt', version: '4.3.1'

    // swagger ( apidoc , mockmvc ì ìš©ì´ ì•ˆë¼ì„œ apidocs?? ê·¸ê±´ í¬ê¸°í•¨. )
    implementation "io.springfox:springfox-boot-starter:3.0.0"

    //spring boot mocking framework
    implementation 'org.mockito:mockito-core:4.4.0'

    // í…ŒìŠ¤íŠ¸ìš©------------------------------
    testImplementation('org.springframework.boot:spring-boot-starter-test')
//            { // junit ì œì™¸
//        exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
//    }
    testCompileOnly 'org.projectlombok:lombok:1.18.20'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.20'
}

//querydsl ì¶”ê°€ ì‹œì‘
// ì´í•˜ì˜ ì„¤ì •ì€ ide, ideì˜ ë²„ì „ë§ˆë‹¤ ë°”ë€” ìˆ˜ ìˆìŒ
//

def querydslDir = "$buildDir/generated/querydsl"
querydsl {
    jpa = true
    querydslSourcesDir = querydslDir
}
sourceSets {
    main.java.srcDir querydslDir
}
configurations {
    querydsl.extendsFrom compileClasspath
}
compileQuerydsl {
    options.annotationProcessorPath = configurations.querydsl
}
compileQuerydsl.doFirst {
    // QíŒŒì¼ì´ ì¡´ì¬í•˜ë©´ ì‚­ì œ í•˜ë„ë¡... ìˆìœ¼ë©´ ì¶©ëŒë‚¨.
    if(file(querydslDir).exists() ) delete(file(querydslDir))
}

//ì¶œì²˜: https://dev-coco.tistory.com/89 [ìŠ¬ê¸°ë¡œìš´ ê°œë°œìƒí™œğŸ˜ƒ]
//querydsl ì¶”ê°€ ë

tasks.named('test') {
    useJUnitPlatform()
}
